<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" href="/aimarketplace-logo.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Marketplace Finland</title>
    <!-- Cookie Consent -->
    <style>
      #cookie-consent {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: #f1f1f1;
        color: #333;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        z-index: 9999;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }
      #cookie-consent button {
        background: #2563eb;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin-left: 10px;
      }
      #cookie-consent a {
        color: #2563eb;
        margin-left: 5px;
      }
    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LJS8NRTEEX"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      // Configure Google tag first to ensure it's detected
      gtag('config', 'G-LJS8NRTEEX');
      
      // Set default consent to 'denied' with Consent Mode v2
      gtag('consent', 'default', {
        'ad_storage': 'denied',
        'analytics_storage': 'denied',
        'functionality_storage': 'denied',
        'personalization_storage': 'denied',
        'security_storage': 'granted',
        'ad_user_data': 'denied',
        'ad_personalization': 'denied',
        'wait_for_update': 500
      });
      
      // For EU region
      gtag('set', 'ads_data_redaction', true);
      gtag('set', 'url_passthrough', true);
      
      // Check if consent was previously given
      if (localStorage.getItem('cookieConsent') === 'accepted') {
        gtag('consent', 'update', {
          'ad_storage': 'granted',
          'analytics_storage': 'granted',
          'functionality_storage': 'granted',
          'personalization_storage': 'granted',
          'security_storage': 'granted',
          'ad_user_data': 'granted',
          'ad_personalization': 'granted'
        });
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <div id="cookie-consent" style="display: none;">
      <div>
        This website uses cookies to improve your experience. 
        <a href="/privacy-policy-en.html">Learn more</a>
      </div>
      <div>
        <button id="cookie-accept">Accept</button>
        <button id="cookie-decline">Decline</button>
      </div>
    </div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // Cookie consent logic
      document.addEventListener('DOMContentLoaded', function() {
        const consent = localStorage.getItem('cookieConsent');
        const banner = document.getElementById('cookie-consent');
        
        // Always show banner during debugging if needed
        // const forceShowBanner = new URLSearchParams(window.location.search).has('debug_consent');
        
        if (!consent) {
          banner.style.display = 'flex';
        }
        
        document.getElementById('cookie-accept').addEventListener('click', function() {
          localStorage.setItem('cookieConsent', 'accepted');
          banner.style.display = 'none';
          
          // Update consent state after user accepts with Consent Mode v2
          gtag('consent', 'update', {
            'ad_storage': 'granted',
            'analytics_storage': 'granted',
            'functionality_storage': 'granted',
            'personalization_storage': 'granted',
            'security_storage': 'granted',
            'ad_user_data': 'granted',
            'ad_personalization': 'granted'
          });
        });
        
        document.getElementById('cookie-decline').addEventListener('click', function() {
          localStorage.setItem('cookieConsent', 'declined');
          banner.style.display = 'none';
        });
      });
    </script>
  </body>
</html>
